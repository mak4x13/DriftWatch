<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DriftWatch</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="orb orb-left"></div>
    <div class="orb orb-right"></div>

    <button
      type="button"
      id="helpToggle"
      class="help-toggle"
      aria-controls="helpSidebar"
      aria-expanded="false"
    >
      ?
    </button>

    <aside id="helpSidebar" class="help-sidebar" aria-hidden="true">
      <div class="help-header">
        <h2>How DriftWatch Works</h2>
        <button type="button" id="helpCloseButton" class="ghost-button sidebar-close">
          Close
        </button>
      </div>
      <section class="help-section">
        <h3>01 Intent Drift Check</h3>
        <p>
          DriftWatch compares every step output against the original user goal before
          it moves forward. If the pipeline starts answering a different question, the
          auditor flags that drift immediately.
        </p>
      </section>
      <section class="help-section">
        <h3>02 Hallucination Detection</h3>
        <p>
          Source documents are embedded into ChromaDB and retrieved during each audit.
          DriftWatch verifies concrete claims against those retrieved passages before
          the next step can rely on them.
        </p>
      </section>
      <section class="help-section">
        <h3>03 Contradiction Guard</h3>
        <p>
          Later pipeline steps are checked against earlier outputs for semantic
          conflicts. That prevents one bad claim from mutating into a polished final
          answer.
        </p>
      </section>
      <section class="help-section help-why">
        <h3>Why This Matters</h3>
        <p>
          Every AI coding agent today writes code and walks away. Every AI research
          tool generates summaries and moves on. DriftWatch is the first tool that
          makes AI accountable for what it produces - catching lies before they reach
          humans.
        </p>
      </section>
    </aside>

    <main class="app-shell">
      <header class="hero">
        <div>
          <p class="eyebrow">Mistral Worldwide Hackathon 2026</p>
          <h1>DriftWatch</h1>
          <p class="subtitle">AI That Catches AI Lying</p>
        </div>
        <div class="hero-actions">
          <div class="hero-controls">
            <button type="button" id="resetDemoButton" class="ghost-button header-button">
              Reset Demo
            </button>
            <section class="protection-panel protection-panel-hero">
              <div class="protection-copy">
                <h3>DriftWatch Protection</h3>
                <p>Toggle live guardrails on or off.</p>
              </div>
              <label class="protection-switch">
                <input type="checkbox" id="protectionToggle" checked />
                <span class="protection-slider"></span>
              </label>
              <div id="protectionState" class="protection-state protection-on">ON</div>
            </section>
          </div>
          <div id="liveBadge" class="hero-badge idle">
            <div class="hero-badge-top">
              <span>Semantic Auditor</span>
              <span id="liveDot" class="live-dot"></span>
            </div>
            <strong id="liveBadgeState">Idle</strong>
          </div>
        </div>
      </header>

      <div id="alertBanner" class="alert-banner" hidden></div>

      <section class="dashboard-grid">
        <section class="panel panel-input">
          <div class="panel-heading">
            <h2>Define Your Pipeline</h2>
            <p>Load a template, tune the steps, and choose whether DriftWatch protects the run.</p>
          </div>

          <div class="template-toolbar">
            <label class="field template-field">
              <span>Load Template</span>
              <select id="templateSelect"></select>
            </label>
            <div class="field template-action">
              <button type="button" id="savePipelineButton" class="ghost-button save-button">
                Save Pipeline
              </button>
            </div>
          </div>

          <label class="field">
            <span>User Goal</span>
            <textarea
              id="userGoal"
              rows="4"
              placeholder="Analyze TechCorp Q3 earnings and write analyst report"
            ></textarea>
          </label>

          <div class="button-row run-actions">
            <button type="button" id="runDemoButton" class="action-button demo-button">
              Run Demo Pipeline
            </button>
            <button type="button" id="runCustomButton" class="action-button custom-button">
              Run Custom Pipeline
            </button>
          </div>

          <label class="field">
            <span>Source Documents</span>
            <textarea
              id="sourceDocuments"
              rows="10"
              placeholder="Paste source documents here. Separate documents with a blank line."
            ></textarea>
          </label>

          <div class="steps-header">
            <span>Pipeline Steps</span>
            <button type="button" id="addStepButton" class="ghost-button">Add Step</button>
          </div>
          <div id="stepsContainer" class="steps-list"></div>
        </section>

        <section class="panel panel-stream">
          <div class="panel-heading">
            <h2>Live Audit Log</h2>
            <p>Watch each step execute, get audited, and self-correct in real time.</p>
          </div>
          <div id="streamStatus" class="stream-status">Waiting for pipeline run.</div>
          <div class="stream-layout">
            <aside id="stepTimeline" class="step-timeline"></aside>
            <div id="eventFeed" class="event-feed"></div>
          </div>
        </section>

        <section class="panel panel-output">
          <div class="panel-heading panel-heading-split">
            <div>
              <h2>Pipeline Output</h2>
              <p>Trust score, hallucination count, and the final corrected report.</p>
            </div>
            <button type="button" id="exportButton" class="ghost-button export-button">
              Export Audit Trail
            </button>
          </div>

          <div class="stats-bar">
            <div class="stat-card">
              <span class="stat-label">Steps</span>
              <strong id="statSteps">0</strong>
            </div>
            <div class="stat-card">
              <span class="stat-label">Hallucinations</span>
              <strong id="statHallucinations">0</strong>
            </div>
            <div class="stat-card">
              <span class="stat-label">Corrections</span>
              <strong id="statCorrections">0</strong>
            </div>
          </div>

          <div class="gauge-card">
            <div class="gauge-header">
              <span>Overall Drift Score</span>
              <strong id="driftScoreLabel">0.00</strong>
            </div>
            <div class="gauge-track">
              <div id="driftGaugeFill" class="gauge-fill"></div>
            </div>
          </div>

          <div id="trustBadge" class="trust-badge neutral">Awaiting run</div>

          <article id="finalOutput" class="final-output">
            <p>Final pipeline output will appear here once the run finishes.</p>
          </article>
        </section>
      </section>
    </main>

    <template id="stepTemplate">
      <article class="step-card">
        <div class="step-card-head">
          <span class="step-index"></span>
          <button type="button" class="remove-step ghost-button">Remove</button>
        </div>
        <label class="field">
          <span>Step Name</span>
          <input type="text" class="step-name" placeholder="Research Summarizer" />
        </label>
        <label class="field">
          <span>Instruction</span>
          <textarea
            class="step-instruction"
            rows="4"
            placeholder="Summarize the key facts from the context."
          ></textarea>
        </label>
      </article>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="./app.js" defer></script>
  </body>
</html>
