<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DriftWatch</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="orb orb-left"></div>
    <div class="orb orb-right"></div>

    <button
      type="button"
      id="helpToggle"
      class="help-toggle"
      aria-controls="helpSidebar"
      aria-expanded="false"
    >
      ?
    </button>

    <aside id="helpSidebar" class="help-sidebar" aria-hidden="true">
      <div class="help-header">
        <h2>How DriftWatch Works</h2>
        <button type="button" id="helpCloseButton" class="ghost-button sidebar-close">
          Close
        </button>
      </div>
      <section class="help-section">
        <h3>01 Intent Drift Check</h3>
        <p>
          DriftWatch compares every step output against the original user goal before
          it moves forward. If the pipeline starts answering a different question, the
          auditor flags that drift immediately.
        </p>
      </section>
      <section class="help-section">
        <h3>02 Hallucination Detection</h3>
        <p>
          Source documents are embedded into ChromaDB and retrieved during each audit.
          DriftWatch verifies concrete claims against those retrieved passages before
          the next step can rely on them.
        </p>
      </section>
      <section class="help-section">
        <h3>03 Contradiction Guard</h3>
        <p>
          Later pipeline steps are checked against earlier outputs for semantic
          conflicts. That prevents one bad claim from mutating into a polished final
          answer.
        </p>
      </section>
      <section class="help-section help-why">
        <h3>Why This Matters</h3>
        <p>
          Every AI coding agent today writes code and walks away. Every AI research
          tool generates summaries and moves on. DriftWatch is the first tool that
          makes AI accountable for what it produces - catching lies before they reach
          humans.
        </p>
      </section>
    </aside>

    <main class="app-shell">
      <header class="hero">
        <div class="hero-copy">
          <p class="eyebrow">Mistral Worldwide Hackathon 2026</p>
          <h1>DriftWatch</h1>
          <p class="subtitle">AI That Catches AI Lying</p>
        </div>
        <div class="hero-actions">
          <div class="hero-controls">
            <button type="button" id="resetDemoButton" class="ghost-button header-button">
              Reset Demo
            </button>
            <section class="protection-panel protection-panel-hero">
              <div class="protection-copy">
                <h3>DriftWatch Protection</h3>
                <p>Toggle guardrails on or off before you run the pipeline.</p>
              </div>
              <label class="protection-switch">
                <input type="checkbox" id="protectionToggle" checked />
                <span class="protection-slider"></span>
              </label>
              <div id="protectionState" class="protection-state protection-on">ON</div>
            </section>
          </div>
          <div id="liveBadge" class="hero-badge idle">
            <div class="hero-badge-top">
              <span>Semantic Auditor</span>
              <span id="liveDot" class="live-dot"></span>
            </div>
            <strong id="liveBadgeState">Idle</strong>
          </div>
        </div>
      </header>

      <div id="alertBanner" class="alert-banner" hidden></div>

      <section class="dashboard-grid">
        <section class="panel panel-input">
          <div class="panel-heading">
            <h2>Define Your Pipeline</h2>
            <p>Set the goal, provide sources, then run the demo or a custom audited pipeline.</p>
          </div>
          <div class="panel-body panel-input-body">
            <div class="panel-scroll panel-input-scroll">
              <label class="field">
                <span>User Goal</span>
                <textarea
                  id="userGoal"
                  rows="4"
                  placeholder="Analyze TechCorp Q3 earnings and write analyst report"
                ></textarea>
              </label>

              <div class="field">
                <span>Source Documents</span>
                <div
                  id="uploadZone"
                  class="upload-zone"
                  role="button"
                  tabindex="0"
                  aria-controls="fileInput"
                  aria-label="Drop files here or click to upload"
                >
                  <div class="upload-zone-copy">
                    <strong>Drop files here or click to upload</strong>
                    <span>Supports .txt, .pdf, and .md files</span>
                  </div>
                </div>
                <input
                  id="fileInput"
                  class="file-input"
                  type="file"
                  accept=".txt,.pdf,.md,text/plain,text/markdown,application/pdf"
                  multiple
                />
                <div id="uploadedFileChips" class="uploaded-file-chips" aria-live="polite"></div>
                <textarea
                  id="sourceDocuments"
                  rows="10"
                  placeholder="Paste source documents here. Separate documents with a blank line."
                ></textarea>
              </div>
            </div>

            <div class="button-row run-actions">
              <button type="button" id="runDemoButton" class="action-button demo-button">
                Run Demo Pipeline
              </button>
              <button type="button" id="runCustomButton" class="action-button custom-button">
                Run Custom Pipeline
              </button>
            </div>
          </div>
        </section>

        <section class="panel panel-stream">
          <div class="panel-heading">
            <h2>Live Audit Log</h2>
            <p>Watch each step execute, get audited, and self-correct in real time.</p>
          </div>
          <div class="panel-body">
            <div id="streamStatus" class="stream-status">Waiting for pipeline run.</div>
            <div id="streamScrollArea" class="stream-layout">
              <aside id="stepTimeline" class="step-timeline"></aside>
              <div id="eventFeed" class="event-feed"></div>
            </div>
          </div>
        </section>

        <section class="panel panel-output">
          <div class="panel-heading panel-heading-split">
            <div>
              <h2>Pipeline Output</h2>
              <p>Trust score, hallucination count, and the final corrected report.</p>
            </div>
            <button type="button" id="exportButton" class="ghost-button export-button">
              Export Audit Trail
            </button>
          </div>
          <div class="panel-body">
            <div class="stats-bar">
              <div class="stat-card">
                <span class="stat-label">Steps</span>
                <strong id="statSteps">0</strong>
              </div>
              <div class="stat-card">
                <span class="stat-label">Hallucinations</span>
                <strong id="statHallucinations">0</strong>
              </div>
              <div class="stat-card">
                <span class="stat-label">Corrections</span>
                <strong id="statCorrections">0</strong>
              </div>
            </div>

            <div class="gauge-card">
              <div class="gauge-header">
                <span>Overall Drift Score</span>
                <strong id="driftScoreLabel">0.00</strong>
              </div>
              <div class="gauge-track">
                <div id="driftGaugeFill" class="gauge-fill"></div>
              </div>
            </div>

            <div id="trustBadge" class="trust-badge neutral">Awaiting run</div>

            <article id="finalOutput" class="final-output">
              <p>Final pipeline output will appear here once the run finishes.</p>
            </article>
          </div>
        </section>
      </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="./app.js" defer></script>
  </body>
</html>
